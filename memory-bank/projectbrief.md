# PROJECT BRIEF - Crypto Helper Bot v2.0

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
Telegram-–±–æ—Ç –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –æ–±–º–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å **–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π** –ø–æ—à–∞–≥–æ–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≤–∞–ª—é—Ç –∏ —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞—Ü–µ–Ω–∫–∏.

## –°—Ç–∞—Ç—É—Å: –ü–û–õ–ù–ê–Ø –ü–ï–†–ï–†–ê–ë–û–¢–ö–ê üîÑ
- **–í–µ—Ä—Å–∏—è:** 2.0 (Clean Slate Development)
- **–§–∞–∑–∞:** IMPLEMENT MODE - –§–∞–∑–∞ 1
- **–ü—Ä–æ–≥—Ä–µ—Å—Å:** 0% –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏, 100% –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä–æ–π

## –ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏

### –ë—ã–ª–æ (v1.0)
```
/admin_bot ‚Üí –≤—ã–±–æ—Ä –≥–æ—Ç–æ–≤–æ–π –ø–∞—Ä—ã (RUB/ZAR, USDT/THB) ‚Üí —Ä–∞—Å—á–µ—Ç
```

### –°—Ç–∞–ª–æ (v2.0)  
```
/admin_bot ‚Üí —á—Ç–æ –æ—Ç–¥–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç? ‚Üí —á—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç? ‚Üí –∫—É—Ä—Å ‚Üí –Ω–∞—Ü–µ–Ω–∫–∞ ‚Üí —Å—É–º–º–∞ ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–±–º–µ–Ω—ã
1. **RUB ‚Üí USDT** - —Ä—É–±–ª–∏ –Ω–∞ Tether
2. **RUB ‚Üí USD** - —Ä—É–±–ª–∏ –Ω–∞ –¥–æ–ª–ª–∞—Ä—ã (—á–µ—Ä–µ–∑ –∫—Ä–æ—Å—Å-–∫—É—Ä—Å)
3. **RUB ‚Üí EUR** - —Ä—É–±–ª–∏ –Ω–∞ –µ–≤—Ä–æ (—á–µ—Ä–µ–∑ –∫—Ä–æ—Å—Å-–∫—É—Ä—Å)
4. **USDT ‚Üí RUB** - Tether –Ω–∞ —Ä—É–±–ª–∏

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω)
- **Python 3.11** + **Aiogram 3.10**
- **API:** Rapira API (USDT/RUB) + API Layer (USD/EUR –∫—Ä–æ—Å—Å-–∫—É—Ä—Å—ã)
- **Deploy:** Railway
- **Arch:** FSM, Domain-Driven Design

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–ª–∞–Ω –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏

### FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Å–æ–∑–¥–∞—Ç—å)
```python
WAITING_FOR_SOURCE_CURRENCY  # RUB –∏–ª–∏ USDT
WAITING_FOR_TARGET_CURRENCY  # –¶–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞  
WAITING_FOR_MARGIN          # –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—Ü–µ–Ω–∫–∏
WAITING_FOR_AMOUNT          # –°—É–º–º–∞ –≤ –∏—Å—Ö–æ–¥–Ω–æ–π –≤–∞–ª—é—Ç–µ
SHOWING_RESULT              # –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

### –ú–æ–¥—É–ª–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è (9 —Ñ–∞–π–ª–æ–≤)
```
handlers/
‚îú‚îÄ‚îÄ fsm_states.py          # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π
‚îú‚îÄ‚îÄ admin_flow.py          # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–ª–æ—É /admin_bot
‚îú‚îÄ‚îÄ currency_selection.py  # –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –≤–∞–ª—é—Ç
‚îú‚îÄ‚îÄ margin_input.py        # –í–≤–æ–¥ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Ü–µ–Ω–∫–∏
‚îú‚îÄ‚îÄ amount_input.py        # –í–≤–æ–¥ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã
‚îú‚îÄ‚îÄ calculation.py         # –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ keyboards.py           # UI –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ validators.py          # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤–≤–æ–¥–æ–≤
‚îî‚îÄ‚îÄ formatters.py          # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
```

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –õ–æ–≥–∏–∫–∞ –Ω–∞—Ü–µ–Ω–∫–∏ (–í–ê–ñ–ù–û!)
```python
# –ö–ª–∏–µ–Ω—Ç –û–¢–î–ê–ï–¢ —Ä—É–±–ª–∏ (–ø–æ–∫—É–ø–∞–µ—Ç –≤–∞–ª—é—Ç—É —É –æ–±–º–µ–Ω–Ω–∏–∫–∞)
RUB ‚Üí USDT/USD/EUR: –∏—Ç–æ–≥–æ–≤—ã–π_–∫—É—Ä—Å = –±–∞–∑–æ–≤—ã–π √ó (1 + –Ω–∞—Ü–µ–Ω–∫–∞/100)

# –ö–ª–∏–µ–Ω—Ç –û–¢–î–ê–ï–¢ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É (–ø—Ä–æ–¥–∞–µ—Ç –≤–∞–ª—é—Ç—É –æ–±–º–µ–Ω–Ω–∏–∫—É)  
USDT ‚Üí RUB: –∏—Ç–æ–≥–æ–≤—ã–π_–∫—É—Ä—Å = –±–∞–∑–æ–≤—ã–π √ó (1 - –Ω–∞—Ü–µ–Ω–∫–∞/100)
```

### –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞
- **–ü—Ä–∏–Ω—Ü–∏–ø:** –í—Å–µ –∫—É—Ä—Å—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞–∫ `1 USDT = X RUB`
- **–î–∞–∂–µ –¥–ª—è USD/EUR:** –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç —á–µ—Ä–µ–∑ USDT

## –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è

### RUB ‚Üí USDT
1. –û–ø–µ—Ä–∞—Ç–æ—Ä: `/admin_bot`
2. –í—ã–±–æ—Ä: `RUB` (—á—Ç–æ –æ—Ç–¥–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç)
3. –í—ã–±–æ—Ä: `USDT` (—á—Ç–æ —Ö–æ—á–µ—Ç –ø–æ–ª—É—á–∏—Ç—å)
4. –ö—É—Ä—Å: `1 USDT = 80 RUB`
5. –ù–∞—Ü–µ–Ω–∫–∞: `2%` ‚Üí –∏—Ç–æ–≥–æ–≤—ã–π –∫—É—Ä—Å: `81.6 RUB –∑–∞ 1 USDT`
6. –°—É–º–º–∞: `1000 RUB`
7. –†–µ–∑—É–ª—å—Ç–∞—Ç: `1000 / 81.6 ‚âà 12.25 USDT`

### USDT ‚Üí RUB  
1. –í—ã–±–æ—Ä: `USDT` ‚Üí `RUB`
2. –ö—É—Ä—Å: `1 USDT = 80 RUB`
3. –ù–∞—Ü–µ–Ω–∫–∞: `2%` ‚Üí –∏—Ç–æ–≥–æ–≤—ã–π –∫—É—Ä—Å: `78.4 RUB –∑–∞ 1 USDT`
4. –°—É–º–º–∞: `10 USDT`
5. –†–µ–∑—É–ª—å—Ç–∞—Ç: `10 √ó 78.4 = 784 RUB`

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ IMPLEMENT

### üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô - –°–µ–π—á–∞—Å –¥–µ–ª–∞—Ç—å
1. **fsm_states.py** - —Å–æ–∑–¥–∞—Ç—å 5 —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM
2. **admin_flow.py** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `/admin_bot` —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏
3. **keyboards.py** - –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
4. **–ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏

### ‚ö° –í–´–°–û–ö–ò–ô - –ù–∞ —Å–ª–µ–¥—É—é—â–µ–º —ç—Ç–∞–ø–µ
5. **currency_selection.py** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä RUB‚ÜíUSDT/USD/EUR
6. **API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –∏ –∫—Ä–æ—Å—Å-–∫—É—Ä—Å—ã
7. **calculation.py** - –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –Ω–∞—Ü–µ–Ω–∫–∏

### üìã –°–†–ï–î–ù–ò–ô - –ü–æ—Ç–æ–º
8. **validators.py** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–æ–≤ (0.1%-10%, —á–∏—Å–ª–∞)
9. **formatters.py** - –∫—Ä–∞—Å–∏–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
10. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - fallback API, –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

## –£–¥–∞–ª–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (100% –∑–∞–≤–µ—Ä—à–µ–Ω–æ)
- ‚úÖ **7 —Ñ–∞–π–ª–æ–≤ —É–¥–∞–ª–µ–Ω–æ** - currency_pairs, calculation_logic, fsm_states, keyboards, formatters, validation, margin_calculation
- ‚úÖ **4 —Ñ–∞–π–ª–∞ —É–ø—Ä–æ—â–µ–Ω—ã** - bot_handlers, admin_handlers, bot.py, config.py
- ‚úÖ **API —Å–µ—Ä–≤–∏—Å—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã** - Rapira, API Layer —Ä–∞–±–æ—Ç–∞—é—Ç

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –§–∞–∑—ã 1
- [ ] –ö–æ–º–∞–Ω–¥–∞ `/admin_bot` –∑–∞–ø—É—Å–∫–∞–µ—Ç FSM
- [ ] –ö–Ω–æ–ø–∫–∏ `RUB`/`USDT` —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ
- [ ] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–Ω–æ–ø–∫–∏ —Ü–µ–ª–µ–≤–æ–π –≤–∞–ª—é—Ç—ã
- [ ] –ë–∞–∑–æ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è (–æ—Ç–º–µ–Ω–∞, –≤–æ–∑–≤—Ä–∞—Ç)

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è
- **–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫:** API —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- **–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫:** –°–ª–æ–∂–Ω–æ—Å—Ç—å –∫—Ä–æ—Å—Å-–∫—É—Ä—Å–æ–≤ USD/EUR
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ü–æ—ç—Ç–∞–ø–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Å–Ω–∞—á–∞–ª–∞ RUB‚ÜîUSDT

## Timeline
- **–ù–µ–¥–µ–ª—è 1:** –§–∞–∑–∞ 1 - –ë–∞–∑–æ–≤–∞—è FSM –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **–ù–µ–¥–µ–ª—è 2:** –§–∞–∑—ã 2-3 - –í—ã–±–æ—Ä –≤–∞–ª—é—Ç + API  
- **–ù–µ–¥–µ–ª—è 3:** –§–∞–∑–∞ 4 - –†–∞—Å—á–µ—Ç—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **–ù–µ–¥–µ–ª—è 4:** –§–∞–∑—ã 5-6 - UI –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ö–æ–º–∞–Ω–¥–∞
- **Developer:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
- **IMPLEMENT Agent:** –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π –ø–æ —Ç–µ—Ö–∑–∞–¥–∞–Ω–∏—é
- **QA:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ FSM —Ñ–ª–æ—É –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏

## Success Metrics
- [ ] –í—Å–µ 4 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±–º–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –í—Ä–µ–º—è —Ä–∞—Å—á–µ—Ç–∞ < 30 —Å–µ–∫—É–Ω–¥
- [ ] –û—à–∏–±–∫–∏ –≤–≤–æ–¥–∞ < 5%
- [ ] –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞
- [ ] –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –Ω–∞—Ü–µ–Ω–∫–∏

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ IMPLEMENT MODE - –Ω–∞—á–∞—Ç—å —Å fsm_states.py