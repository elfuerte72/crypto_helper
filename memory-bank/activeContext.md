# ACTIVE CONTEXT - Crypto Helper Bot (–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)

## –¢–µ–∫—É—â–∞—è —Ñ–∞–∑–∞: IMPLEMENT MODE
**–ó–∞–¥–∞—á–∞:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–π –ø–æ—à–∞–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ –æ–±–º–µ–Ω–∞ –≤–∞–ª—é—Ç

## –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞: –ü–û–õ–ù–ê–Ø –ü–ï–†–ï–†–ê–ë–û–¢–ö–ê
- [x] ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ç–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [x] ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –≤—Å—è —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –≤–∞–ª—é—Ç–Ω—ã—Ö –ø–∞—Ä –∏ —Ä–∞—Å—á–µ—Ç–æ–≤  
- [x] ‚úÖ –û—á–∏—â–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –Ω–æ–≤–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [ ] üîÑ **–¢–ï–ö–£–©–ï–ï:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ (–§–∞–∑–∞ 1)

## –ß—Ç–æ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)
```
–£–î–ê–õ–ï–ù–ù–´–ï –§–ê–ô–õ–´:
- src/handlers/currency_pairs.py - –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ –≤–∞–ª—é—Ç–Ω—ã–µ –ø–∞—Ä—ã
- src/handlers/calculation_logic.py - —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞—Ü–µ–Ω–∫–∏  
- src/handlers/fsm_states.py - —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ —Ñ–ª–æ—É
- src/handlers/keyboards.py - –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –≤–∞–ª—é—Ç–Ω—ã—Ö –ø–∞—Ä
- src/handlers/formatters.py - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–∏
- src/handlers/validation.py - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º—ã
- src/handlers/margin_calculation.py - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
```

## –ù–æ–≤—ã–π –±–∏–∑–Ω–µ—Å-—Ñ–ª–æ—É (–∏–∑ –ø—Ä–æ–º–ø—Ç–∞)

### –ö–æ–º–∞–Ω–¥–∞: `/admin_bot`
1. **–í—ã–±–æ—Ä –∏—Å—Ö–æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã:** RUB –∏–ª–∏ USDT (—á—Ç–æ –æ—Ç–¥–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç)
2. **–í—ã–±–æ—Ä —Ü–µ–ª–µ–≤–æ–π –≤–∞–ª—é—Ç—ã:** 
   - –ï—Å–ª–∏ RUB ‚Üí USDT, USD, EUR
   - –ï—Å–ª–∏ USDT ‚Üí RUB
3. **–ü–æ–∫–∞–∑ –∫—É—Ä—Å–∞:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç "1 USDT = X RUB"
4. **–í–≤–æ–¥ –Ω–∞—Ü–µ–Ω–∫–∏:** –¢–æ–ª—å–∫–æ —á–∏—Å–ª–æ (2, 1.5, 0.75)
5. **–í–≤–æ–¥ —Å—É–º–º—ã:** –ß–∏—Å–ª–æ –≤ –æ—Ç–¥–∞–≤–∞–µ–º–æ–π –≤–∞–ª—é—Ç–µ  
6. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞—Å—á–µ—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –Ω–∞—Ü–µ–Ω–∫–∏

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç IMPLEMENT (—á—Ç–æ –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å)

### üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô - –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ FSM
```python
# –°–û–ó–î–ê–¢–¨:
src/handlers/fsm_states.py      # 5 —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM
src/handlers/admin_flow.py      # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–ª–æ—É /admin_bot  
src/handlers/keyboards.py       # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
src/handlers/validators.py      # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–æ–≤
```

### FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```python
class ExchangeFlow(StatesGroup):
    WAITING_FOR_SOURCE_CURRENCY = State()  # RUB/USDT
    WAITING_FOR_TARGET_CURRENCY = State()  # –¶–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞
    WAITING_FOR_MARGIN = State()           # –í–≤–æ–¥ –Ω–∞—Ü–µ–Ω–∫–∏ %
    WAITING_FOR_AMOUNT = State()           # –í–≤–æ–¥ —Å—É–º–º—ã
    SHOWING_RESULT = State()               # –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```

## –ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞ –Ω–∞—Ü–µ–Ω–∫–∏ (–í–ê–ñ–ù–û!)
```python
# RUB ‚Üí USDT/USD/EUR: –ò—Ç–æ–≥–æ–≤—ã–π = –ë–∞–∑–æ–≤—ã–π √ó (1 + –Ω–∞—Ü–µ–Ω–∫–∞/100)
# USDT ‚Üí RUB: –ò—Ç–æ–≥–æ–≤—ã–π = –ë–∞–∑–æ–≤—ã–π √ó (1 - –Ω–∞—Ü–µ–Ω–∫–∞/100)
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –¥–ª—è IMPLEMENT

### Domain –º–æ–¥–µ–ª–∏:
```python
class Currency(Enum):
    RUB = "RUB"
    USDT = "USDT" 
    USD = "USD"
    EUR = "EUR"
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
```python
SUPPORTED_SOURCES = [Currency.RUB, Currency.USDT]
TARGETS_FOR_RUB = [Currency.USDT, Currency.USD, Currency.EUR]
TARGETS_FOR_USDT = [Currency.RUB]
```

### –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞:
**–î–ª—è –í–°–ï–• –ø–∞—Ä –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:** `1 USDT = [—á–∏—Å–ª–æ] RUB`

## –¢–µ–∫—É—â–∏–µ —Ä–∞–±–æ—á–∏–µ —Ñ–∞–π–ª—ã
- `src/handlers/admin_handlers.py` - –∫–æ–º–∞–Ω–¥–∞ /admin_bot (–∑–∞–≥–ª—É—à–∫–∞)
- `src/handlers/bot_handlers.py` - –ø—É—Å—Ç–æ–π —Ä–æ—É—Ç–µ—Ä (–∑–∞–≥–ª—É—à–∫–∞)
- `src/bot.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª (–æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏)
- `src/config.py` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ—á–∏—â–µ–Ω–∞)
- `src/services/api_service.py` - API –∫–ª–∏–µ–Ω—Ç—ã (—Ä–∞–±–æ—á–∏–µ)

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ IMPLEMENT
1. **–°–æ–∑–¥–∞—Ç—å fsm_states.py** - –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å 5 —Å–æ—Å—Ç–æ—è–Ω–∏–π
2. **–°–æ–∑–¥–∞—Ç—å admin_flow.py** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ /admin_bot + FSM
3. **–°–æ–∑–¥–∞—Ç—å keyboards.py** - –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
4. **–û–±–Ω–æ–≤–∏—Ç—å admin_handlers.py** - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–ª–æ—É
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** - –±–∞–∑–æ–≤—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –§–∞–∑—ã 1
- [ ] –ö–æ–º–∞–Ω–¥–∞ /admin_bot –∑–∞–ø—É—Å–∫–∞–µ—Ç FSM
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ RUB/USDT
- [ ] –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- [ ] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–Ω–æ–ø–∫–∏ —Ü–µ–ª–µ–≤–æ–π –≤–∞–ª—é—Ç—ã
- [ ] –ë–∞–∑–æ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

## API endpoints (—É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç)
- Rapira API: –∫—É—Ä—Å—ã USDT/RUB
- API Layer: –∫—Ä–æ—Å—Å-–∫—É—Ä—Å—ã USD/USDT, EUR/USDT

## –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- RUB ‚Üí USDT: –∫—É—Ä—Å 80, –Ω–∞—Ü–µ–Ω–∫–∞ 2% ‚Üí 81.6, —Å—É–º–º–∞ 1000 ‚Üí 12.25 USDT
- USDT ‚Üí RUB: –∫—É—Ä—Å 80, –Ω–∞—Ü–µ–Ω–∫–∞ 2% ‚Üí 78.4, —Å—É–º–º–∞ 10 ‚Üí 784 RUB